<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DTD Serwis - Najmy Zaplanowane (Rezerwacje)</title>
    
    <!-- Biblioteki Zewnętrzne -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           KONFIGURACJA UI I MOTYWU BAZOWEGO
           ========================================= */
        :root {
            --bg-body: #f8fafc;
            --bg-sidebar: #0f172a;
            --sidebar-hover: #1e293b;
            --accent-blue: #0284c7;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
            --card-bg: #ffffff;
            
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;

            --dark-panel: #0f1419;
            --dark-border: #2a3136;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg-body); color: var(--text-main); display: flex; height: 100vh; overflow: hidden; }

        /* =========================================
           SIDEBAR (ZGODNY Z ERP)
           ========================================= */
        .sidebar { width: 280px; background-color: var(--bg-sidebar); color: white; display: flex; flex-direction: column; flex-shrink: 0; overflow-y: auto; box-shadow: 4px 0 15px rgba(0,0,0,0.15); }
        .sidebar::-webkit-scrollbar { width: 5px; }
        .sidebar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        .sidebar-header { padding: 35px 25px; font-size: 24px; font-weight: 900; border-bottom: 1px solid rgba(255,255,255,0.05); letter-spacing: -0.5px; }
        .sidebar-header span { color: var(--accent-blue); }
        
        .nav-menu { flex: 1; padding: 20px 0; }
        .nav-item { padding: 12px 25px; margin: 2px 12px; border-radius: 10px; display: flex; align-items: center; gap: 12px; color: #94a3b8; text-decoration: none; font-weight: 500; font-size: 14px; transition: 0.2s; cursor: pointer; border-left: 3px solid transparent; }
        .nav-item:hover { background-color: var(--sidebar-hover); color: white; }
        .nav-item.active { background-color: rgba(2, 132, 199, 0.15); color: white; border-left-color: var(--accent-blue); font-weight: 600; }
        .nav-item i { width: 20px; text-align: center; }

        .submenu { background-color: rgba(0,0,0,0.2); margin-bottom: 5px; padding: 5px 0; display: none; }
        .submenu-label { padding: 12px 25px 5px 55px; font-size: 10px; text-transform: uppercase; color: #475569; font-weight: 800; letter-spacing: 1px; }
        .submenu-item { padding: 8px 25px 8px 55px; display: block; color: #94a3b8; text-decoration: none; font-size: 13px; transition: 0.2s; border-left: 3px solid transparent;}
        .submenu-item:hover { color: white; background-color: var(--sidebar-hover); }
        .submenu-item.active { color: white; font-weight: 700; border-left-color: var(--accent-blue); }

        /* =========================================
           TOPBAR & WRAPPER
           ========================================= */
        .main-wrapper { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .topbar { background: white; padding: 0 40px; height: 80px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); z-index: 10; }
        .search-bar { background: #f1f5f9; padding: 10px 18px; border-radius: 10px; display: flex; align-items: center; gap: 12px; width: 350px; }
        .search-bar input { border: none; background: transparent; outline: none; width: 100%; font-size: 14px; font-weight: 500; }
        
        .content-area { padding: 40px; overflow-y: auto; flex: 1; position: relative; }
        .view-panel { display: none; animation: fadeIn 0.4s ease; }
        .view-panel.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* BAZOWE ELEMENTY BAZY DANYCH */
        .header-actions { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .page-title { font-size: 24px; font-weight: 800; color: var(--text-main); display: flex; align-items: center; gap: 12px; }
        .card { background: white; border: 1px solid var(--border-color); border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); margin-bottom: 30px; overflow: hidden; transition: 0.3s; }
        .card-header { padding: 20px 30px; border-bottom: 1px solid var(--border-color); background: #fcfcfd; font-size: 14px; font-weight: 800; color: var(--accent-blue); text-transform: uppercase; display: flex; justify-content: space-between; align-items: center; letter-spacing: 0.5px; }
        .card-body { padding: 30px; }

        /* TABELA */
        table { width: 100%; border-collapse: collapse; font-size: 13px; text-align: left; }
        th { padding: 15px 20px; background-color: #f8fafc; color: var(--text-muted); font-weight: 700; text-transform: uppercase; font-size: 11px; border-bottom: 2px solid var(--border-color); }
        td { padding: 18px 20px; border-bottom: 1px solid var(--border-color); color: var(--text-main); vertical-align: middle; }
        tr:hover td { background-color: #f8fafc; cursor: pointer; }

        .status-badge { padding: 6px 12px; border-radius: 8px; font-size: 10px; font-weight: 900; text-transform: uppercase; display: inline-block; }
        .st-planned { background: #e0f2fe; color: #0369a1; border: 1px solid #bae6fd; }
        .st-today { background: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; animation: pulse 2s infinite;}
        .st-warning { background: #fef3c7; color: #92400e; border: 1px solid #fde68a; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 70% { box-shadow: 0 0 0 6px rgba(16, 185, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }
        
        .reg-badge { background: #1e293b; color: #fff; padding: 4px 12px; border-radius: 6px; font-family: 'Courier New', monospace; font-weight: 800; font-size: 14px; letter-spacing: 1px; display: inline-block; text-transform: uppercase; }

        /* BUTTONY */
        .btn { padding: 12px 24px; border-radius: 8px; font-weight: 700; font-size: 13px; cursor: pointer; border: none; display: inline-flex; align-items: center; gap: 8px; transition: 0.2s; }
        .btn-primary { background: var(--accent-blue); color: white; box-shadow: 0 4px 10px rgba(2, 132, 199, 0.2); }
        .btn-primary:hover { background: #0369a1; transform: translateY(-2px); }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-secondary { background: white; border: 1px solid var(--border-color); color: var(--text-main); }

        /* =========================================
           WIDOK DETALI REZERWACJI
           ========================================= */
        .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        @media (max-width: 1100px) { .details-grid { grid-template-columns: 1fr; } }
        .info-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; font-size: 13.5px; border-bottom: 1px dashed #e2e8f0; padding-bottom: 10px; }
        .info-row:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0;}
        .info-label { color: var(--text-muted); font-weight: 600; width: 40%; flex-shrink: 0;}
        .info-value { font-weight: 700; color: var(--text-main); text-align: right; word-break: break-word;}
        
        .alert-box { background: #fffbeb; border: 1px solid #fde68a; border-left: 4px solid var(--warning); padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 13px; color: #92400e; font-weight: 600; }

        /* Inline Edit Styles */
        #view-details .info-edit[contenteditable="true"] { background-color: #fffbeb; border: 1px dashed #fbbf24; padding: 2px 6px; border-radius: 4px; outline: none; cursor: text; transition: 0.2s; }
        #view-details .info-edit[contenteditable="true"]:focus { background-color: white; border-color: var(--accent-blue); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }

        /* Modale */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(5px); z-index: 1000; align-items: center; justify-content: center; }
        .modal-card { background: white; width: 500px; max-width: 90vw; border-radius: 16px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); overflow: hidden; }
        .modal-header { padding: 20px 30px; background: #f8fafc; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; font-size: 18px; font-weight: 800; color: var(--text-dark); }
        .modal-body { padding: 30px; max-height: 80vh; overflow-y: auto;}

        /* =========================================
           KREATOR FORMULARZA
           ========================================= */
        .form-container { max-width: 900px; margin: 0 auto; }
        .form-grid { display: grid; gap: 20px; margin-bottom: 20px; }
        .form-row-2 { grid-template-columns: 1fr 1fr; }
        @media (max-width: 768px) { .form-row-2 { grid-template-columns: 1fr; } }
        
        .form-group { display: flex; flex-direction: column; gap: 8px; }
        .form-group.full-width { grid-column: 1 / -1; }
        
        .creator-label { font-size: 12px; font-weight: 800; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .required::after { content: '*'; color: var(--danger); margin-left: 4px; font-size: 14px; }
        
        .creator-input { padding: 14px 16px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 14px; color: var(--text-main); background: white; outline: none; transition: 0.3s; font-family: inherit; width: 100%; }
        .creator-input:focus { border-color: var(--accent-blue); box-shadow: 0 0 0 3px rgba(2, 132, 199, 0.1); }
        textarea.creator-input { resize: vertical; min-height: 80px; }
        .creator-input:disabled { background: #f1f5f9; color: var(--text-muted); cursor: not-allowed; }

        /* Radio Kafelki (Kontekst / Logistyka) */
        .radio-group { display: flex; gap: 15px; margin-bottom: 20px; }
        @media (max-width: 600px) { .radio-group { flex-direction: column; } }
        .radio-option { flex: 1; position: relative; }
        .radio-option input { position: absolute; opacity: 0; cursor: pointer; }
        .radio-label { 
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px;
            padding: 20px 15px; background-color: #f8fafc; border: 2px solid var(--border-color); 
            border-radius: 12px; color: var(--text-muted); font-weight: 700; font-size: 13px; cursor: pointer; transition: 0.2s; text-align: center; height: 100%;
        }
        .radio-option:hover input ~ .radio-label { background-color: #f1f5f9; border-color: #94a3b8; }
        .radio-option input:checked ~ .radio-label { border-color: var(--accent-blue); background-color: #f0f9ff; color: var(--accent-blue); box-shadow: 0 4px 10px rgba(2, 132, 199, 0.1);}
        .radio-label i { font-size: 24px; margin-bottom: 5px; }

        /* Logistyka specjalne kolory */
        .log-option input[value="pickup"]:checked ~ .radio-label { border-color: var(--success); background-color: #ecfdf5; color: #047857; }
        .log-option input[value="delivery"]:checked ~ .radio-label { border-color: var(--warning); background-color: #fffbeb; color: #b45309; }

        .dynamic-section { display: none; animation: fadeIn 0.3s; margin-top: 10px;}
        .dynamic-section.active { display: block; }

        /* Elementy Checkbox (np. Godzina do ustalenia) */
        .check-box-wrapper { display: flex; align-items: center; gap: 10px; background: #fffbeb; border: 1px solid #fde68a; padding: 14px 16px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .check-box-wrapper:hover { background: #fef3c7; }
        .check-box-wrapper input { width: 18px; height: 18px; accent-color: var(--warning); cursor: pointer; }
        .check-box-text { font-size: 13px; font-weight: 700; color: #b45309; }

    </style>
</head>
<body>

    <!-- SIDEBAR KOMPLETNY (ZGODNY Z ERP) -->
    <div class="sidebar">
        <div class="sidebar-header"><span>DTD</span> Serwis</div>
        <div class="nav-menu">
            <a href="index.html" class="nav-item"><i class="fa-solid fa-chart-line"></i> Dashboard</a>
            <a href="szkody.html" class="nav-item"><i class="fa-solid fa-clipboard-list"></i> Lista Szkód</a>
            
            <div class="nav-item active has-submenu" onclick="toggleSubmenu('submenu-samochody')">
                <div style="display:flex; align-items:center; gap:12px;"><i class="fa-solid fa-car"></i> Samochody</div>
                <i class="fa-solid fa-chevron-down" id="icon-samochody" style="font-size: 10px; transform: rotate(180deg);"></i>
            </div>
            <div class="submenu" id="submenu-samochody" style="display: block;">
                <div class="submenu-label">Najmy</div>
                <a href="najmy_trwajace.html" class="submenu-item">Najmy w trakcie</a>
                <a href="najmy_zaplanowane.html" class="submenu-item active">Najmy zaplanowane</a>
                <a href="najmy_archiwum.html" class="submenu-item">Najmy zakończone (Archiwum)</a>
                <div class="submenu-label">Flota własna</div>
                <a href="flota_jezdzace.html" class="submenu-item">Pojazdy jeżdżące</a>
                <a href="flota_sprzedane.html" class="submenu-item">Sprzedane / Zezłom.</a>
                <a href="flota_podnajete.html" class="submenu-item">Pojazdy podnajęte</a>
                <a href="flota_podnajete_arch.html" class="submenu-item">Podnajęte - Archiwum</a>
            </div>

            <a href="holowania.html" class="nav-item"><i class="fa-solid fa-truck-pickup"></i> Holowania</a>
            <a href="ogledziny.html" class="nav-item"><i class="fa-solid fa-magnifying-glass"></i> Oględziny</a>
            <a href="dane.html" class="nav-item"><i class="fa-solid fa-database"></i> Dane</a>
            <a href="magazyn.html" class="nav-item"><i class="fa-solid fa-boxes-stacked"></i> Magazyn i części</a>
            <a href="rozliczenia.html" class="nav-item"><i class="fa-solid fa-file-invoice-dollar"></i> Rozliczenia</a>
            <a href="dzial_prawny.html" class="nav-item"><i class="fa-solid fa-scale-balanced"></i> Dział prawny</a>
            
            <div class="nav-item has-submenu" onclick="toggleSubmenu('submenu-naprawy')">
                <div style="display:flex; align-items:center; gap:12px;"><i class="fa-solid fa-wrench"></i> Naprawy</div>
                <i class="fa-solid fa-chevron-down" id="icon-naprawy" style="font-size: 10px;"></i>
            </div>
            <div class="submenu" id="submenu-naprawy">
                <a href="naprawy_blacharnia.html" class="submenu-item">Warsztat blacharsko-lakierniczy</a>
                <a href="naprawy_elektronika.html" class="submenu-item">Warsztat elektroniki pojazdowej</a>
                <a href="naprawy_mechanika.html" class="submenu-item">Warsztat mechaniczny</a>
                <a href="naprawy_inne.html" class="submenu-item">Inne naprawy</a>
            </div>

            <a href="dokumenty.html" class="nav-item"><i class="fa-solid fa-file-pdf"></i> Generator dokumentów</a>
        </div>
    </div>

    <!-- MAIN WRAPPER -->
    <div class="main-wrapper">
        <div class="topbar">
            <div class="search-bar"><i class="fa-solid fa-magnifying-glass"></i><input type="text" placeholder="Szukaj rezerwacji, klienta, nr szkody..."></div>
            <div class="user-info">
                <i class="fa-regular fa-bell" style="font-size:20px; cursor:pointer; color:var(--text-muted); margin-right:20px;"></i>
                <span style="font-weight:700;">admin@dtdserwis.pl</span>
            </div>
        </div>

        <div class="content-area">

            <!-- WIDOK 1: REJESTR ZAPLANOWANYCH NAJMÓW -->
            <div id="view-list" class="view-panel active">
                <div class="header-actions">
                    <div class="page-title"><i class="fa-regular fa-calendar-check" style="color:var(--accent-blue)"></i> Harmonogram Rezerwacji Aut</div>
                    <button class="btn btn-primary" onclick="toggleViews('view-form')"><i class="fa-solid fa-plus-circle"></i> Zaplanuj Nowy Najem</button>
                </div>
                
                <div class="alert-box">
                    <i class="fa-solid fa-circle-exclamation"></i> Masz 1 rezerwację zaplanowaną na dzisiaj. Upewnij się, że auto jest umyte i zatankowane.
                </div>

                <div class="card">
                    <table>
                        <thead>
                            <tr>
                                <th>Nr Rezerwacji / Kontekst</th>
                                <th>Termin / Logistyka</th>
                                <th>Klient / Kontakt</th>
                                <th>Zarezerwowane Auto</th>
                                <th>Status / Termin</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr onclick="showReservationDetails('REZ-2026/03/10')">
                                <td><strong>REZ-2026/03/10</strong><br><small class="text-muted">Do Szkody: DTD-2026-090</small></td>
                                <td><strong>Dzisiaj, 14:00</strong><br><small class="text-muted"><i class="fa-solid fa-building"></i> Odbiór w Serwisie</small></td>
                                <td>Kamil Nowak<br><small class="text-muted">+48 500 600 700</small></td>
                                <td><span class="reg-badge">WA 12345</span><br>Toyota Yaris (B)</td>
                                <td><span class="status-badge st-today">NA DZIŚ</span></td>
                            </tr>
                            <tr onclick="showReservationDetails('REZ-2026/03/15')">
                                <td><strong>REZ-2026/03/15</strong><br><small class="text-muted">Zastępczy do Naprawy</small></td>
                                <td><strong>15.03.2026, 08:30</strong><br><small class="text-muted"><i class="fa-solid fa-truck-fast"></i> Podstawienie do Klienta</small></td>
                                <td>Firma ABC Sp. z o.o.<br><small class="text-muted">Jan Kowalski</small></td>
                                <td><span class="reg-badge">WX 99881</span><br>Skoda Octavia (C)</td>
                                <td><span class="status-badge st-planned">Oczekuje</span></td>
                            </tr>
                            <tr onclick="showReservationDetails('REZ-2026/03/20')">
                                <td><strong>REZ-2026/03/20</strong><br><small class="text-muted">Prywatny</small></td>
                                <td><strong>20.03.2026, <span style="color:var(--warning)">TBD</span></strong><br><small class="text-muted"><i class="fa-solid fa-building"></i> Odbiór w Serwisie</small></td>
                                <td>Anna Kowalczyk<br><small class="text-muted">+48 666 777 888</small></td>
                                <td><span class="reg-badge">PO 11223</span><br>Kia Ceed (C)</td>
                                <td><span class="status-badge st-planned">Oczekuje</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- WIDOK 2: KARTA DETALI REZERWACJI -->
            <div id="view-details" class="view-panel">
                <div class="header-actions">
                    <div class="page-title"><i class="fa-regular fa-calendar-check"></i> Szczegóły Rezerwacji: <span id="detail-nr" style="color:var(--accent-blue)">REZ-2026/03/10</span></div>
                    <div style="display:flex; gap:10px;">
                        <button class="btn btn-secondary" onclick="toggleViews('view-list')"><i class="fa-solid fa-arrow-left"></i> Wróć</button>
                        <button class="btn btn-danger" onclick="openCancelModal()"><i class="fa-solid fa-trash"></i> Anuluj</button>
                        <button class="btn btn-secondary" id="editDetailsBtn" onclick="toggleEditMode()"><i class="fa-solid fa-pen"></i> Edytuj</button>
                        <button class="btn btn-success" onclick="alert('Przekierowanie do kreatora Wydania Auta z zaciągniętymi danymi klienta...')"><i class="fa-solid fa-key"></i> Wydaj Pojazd (Start Najmu)</button>
                    </div>
                </div>

                <div class="details-grid">
                    <div class="left-col">
                        <div class="card">
                            <div class="card-header"><i class="fa-solid fa-user"></i> Informacje o Kliencie i Sprawie</div>
                            <div class="card-body">
                                <div class="info-row"><div class="info-label">Imię i Nazwisko / Firma:</div><div class="info-value info-edit">Kamil Nowak</div></div>
                                <div class="info-row"><div class="info-label">Telefon kontaktowy:</div><div class="info-value info-edit">+48 500 600 700</div></div>
                                <div style="border-top:1px solid var(--border-light); margin:15px 0;"></div>
                                <div class="info-row"><div class="info-label">Cel Najmu:</div><div class="info-value info-edit">Do Szkody (OC/AC)</div></div>
                                <div class="info-row"><div class="info-label">Powiązany numer z systemu:</div><div class="info-value info-edit"><a href="#" style="color:var(--accent-blue); font-weight:800;">DTD-2026-090</a></div></div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header"><i class="fa-solid fa-car"></i> Zarezerwowany Pojazd</div>
                            <div class="card-body">
                                <div class="info-row"><div class="info-label">Pojazd z floty DTD:</div><div class="info-value info-edit">Toyota Yaris Comfort (Klasa B)</div></div>
                                <div class="info-row"><div class="info-label">Numer Rejestracyjny:</div><div class="info-value info-edit"><span class="reg-badge">WA 12345</span></div></div>
                                <div class="info-row"><div class="info-label">Paliwo / Skrzynia:</div><div class="info-value info-edit">Benzyna / Automatyczna</div></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="right-col">
                        <div class="card" style="border-color: var(--accent-blue);">
                            <div class="card-header" style="background: #f0f9ff; color: var(--accent-blue);"><i class="fa-solid fa-calendar-days"></i> Harmonogram i Logistyka</div>
                            <div class="card-body">
                                <div class="info-row"><div class="info-label">Planowany start:</div><div class="info-value info-edit" style="font-size:15px; color:var(--accent-blue);">Dzisiaj (01.03.2026)</div></div>
                                <div class="info-row"><div class="info-label">Godzina przekazania:</div><div class="info-value info-edit" style="font-size:15px;">14:00</div></div>
                                <div class="info-row"><div class="info-label">Planowany zwrot:</div><div class="info-value info-edit">15.03.2026</div></div>
                                <div style="border-top:1px solid var(--border-light); margin:15px 0;"></div>
                                <div class="info-row"><div class="info-label">Metoda wydania:</div><div class="info-value info-edit" style="color:var(--success);"><i class="fa-solid fa-building"></i> Klient przyjedzie do Serwisu</div></div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header"><i class="fa-solid fa-clipboard"></i> Uwagi do rezerwacji</div>
                            <div class="card-body">
                                <p class="info-edit" style="font-size: 13px; line-height: 1.5; color: var(--text-dark); background: #fffbeb; padding: 15px; border-radius: 8px; border: 1px solid #fde68a;">
                                    <strong>Uwaga:</strong> Klient prosi o włożenie fotelika dla dziecka do bagażnika. Auto musi być zatankowane do pełna, klient jedzie w dłuższą trasę od razu po odbiorze.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- WIDOK 3: KREATOR REZERWACJI -->
            <div id="view-form" class="view-panel">
                
                <div class="header-actions">
                    <div class="page-title"><i class="fa-solid fa-calendar-plus" style="color:var(--accent-blue)"></i> Kreator Rezerwacji Pojazdu</div>
                    <div style="display:flex; gap:10px;">
                        <button class="btn btn-secondary" onclick="toggleViews('view-list')"><i class="fa-solid fa-xmark"></i> Anuluj</button>
                        <button class="btn btn-primary" onclick="saveReservation()"><i class="fa-solid fa-save"></i> Zapisz Rezerwację</button>
                    </div>
                </div>

                <div class="form-container">
                    <form id="reservationForm">

                        <div class="card">
                            <div class="card-header"><i class="fa-solid fa-link"></i> 1. Cel Najmu i Powiązanie</div>
                            <div class="card-body">
                                
                                <div class="radio-group">
                                    <label class="radio-option">
                                        <input type="radio" name="rentContext" value="szkoda" checked onchange="toggleResContext()">
                                        <span class="radio-label">
                                            <i class="fa-solid fa-car-burst"></i> Do Szkody (OC/AC)
                                        </span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="rentContext" value="naprawa" onchange="toggleResContext()">
                                        <span class="radio-label">
                                            <i class="fa-solid fa-wrench"></i> Do Naprawy / Opóźnienia
                                        </span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="rentContext" value="inne" onchange="toggleResContext()">
                                        <span class="radio-label">
                                            <i class="fa-solid fa-user-clock"></i> Inne (Brak powiązania)
                                        </span>
                                    </label>
                                </div>

                                <div class="form-group dynamic-section active" id="contextReferenceBox">
                                    <label class="creator-label required" id="contextLabel">Numer Szkody</label>
                                    <input type="text" id="contextInput" class="creator-input" placeholder="Wyszukaj szkodę w systemie..." required>
                                </div>

                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header"><i class="fa-solid fa-user"></i> 2. Klient i Wybór Pojazdu</div>
                            <div class="card-body">
                                <div class="form-grid form-row-2">
                                    <div class="form-group">
                                        <label class="creator-label required">Imię i Nazwisko / Nazwa Klienta</label>
                                        <input type="text" class="creator-input" placeholder="Jan Kowalski" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="creator-label required">Numer Kontaktowy</label>
                                        <input type="tel" class="creator-input" placeholder="+48 000 000 000" required>
                                    </div>
                                    <div class="form-group full-width">
                                        <label class="creator-label required">Zarezerwuj Pojazd (Z dostępnych w danym terminie)</label>
                                        <select class="creator-input" required style="font-weight: 700; font-size: 15px; border-color: var(--accent-blue);">
                                            <option value="" disabled selected>-- Wybierz auto z floty --</option>
                                            <optgroup label="Klasa B">
                                                <option>Toyota Yaris [WA 12345] - Benzyna</option>
                                                <option>Skoda Fabia [KR 55667] - LPG</option>
                                            </optgroup>
                                            <optgroup label="Klasa C">
                                                <option>Skoda Octavia [GD 88990] - Diesel</option>
                                            </optgroup>
                                            <optgroup label="Pojazdy Specjalne">
                                                <option>Toyota Corolla [WJ 11223] - Taxi</option>
                                            </optgroup>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header"><i class="fa-solid fa-calendar-days"></i> 3. Harmonogram i Logistyka</div>
                            <div class="card-body">
                                
                                <div class="form-grid form-row-2" style="border-bottom: 1px dashed var(--border-color); padding-bottom: 20px; margin-bottom: 20px;">
                                    <div class="form-group">
                                        <label class="creator-label required">Planowana Data Rozpoczęcia</label>
                                        <input type="date" class="creator-input" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="creator-label required">Planowana Data Zwrotu</label>
                                        <input type="date" class="creator-input" required>
                                    </div>
                                </div>

                                <label class="creator-label" style="display: block; margin-bottom:10px;">Miejsce wydania pojazdu (Logistyka):</label>
                                <div class="radio-group" style="margin-bottom: 15px;">
                                    <label class="radio-option log-option">
                                        <input type="radio" name="logisticsType" value="pickup" checked onchange="toggleLogistics()">
                                        <span class="radio-label">
                                            <i class="fa-solid fa-building"></i> Klient przyjedzie do Serwisu
                                        </span>
                                    </label>
                                    <label class="radio-option log-option">
                                        <input type="radio" name="logisticsType" value="delivery" onchange="toggleLogistics()">
                                        <span class="radio-label">
                                            <i class="fa-solid fa-truck-fast"></i> My podstawiamy auto do Klienta
                                        </span>
                                    </label>
                                </div>

                                <div class="form-group dynamic-section" id="deliveryAddressBox" style="margin-bottom: 20px;">
                                    <label class="creator-label required">Dokładny adres podstawienia</label>
                                    <input type="text" id="deliveryAddressInput" class="creator-input" placeholder="Ulica, numer domu, kod pocztowy, miejscowość">
                                </div>

                                <div class="form-grid form-row-2" style="align-items: center;">
                                    <div class="form-group">
                                        <label class="creator-label required" id="timeLabel">Godzina Wydania / Podstawienia</label>
                                        <input type="time" id="timeInput" class="creator-input" required>
                                    </div>
                                    <div class="form-group" style="padding-top: 15px;">
                                        <label class="check-box-wrapper">
                                            <input type="checkbox" id="tbdCheck" onchange="toggleTimeInput()">
                                            <span class="check-box-text"><i class="fa-solid fa-phone-volume"></i> Godzina do ustalenia w dniu najmu</span>
                                        </label>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header"><i class="fa-solid fa-clipboard"></i> 4. Dodatkowe Uwagi (Dla Biura i Kierowców)</div>
                            <div class="card-body" style="padding-top: 15px;">
                                <textarea class="creator-input" placeholder="Wszelkie ważne informacje. Np:&#10;- Klient prosi o fotelik dla dziecka w bagażniku.&#10;- Dzwonić pod drugi numer telefonu w razie braku odbioru."></textarea>
                            </div>
                        </div>

                    </form>
                </div>
            </div>

        </div>
    </div>

    <!-- MODAL: ANULOWANIE REZERWACJI -->
    <div class="modal-overlay" id="cancelReservationModal">
        <div class="modal-card">
            <div class="modal-header"><h3 style="color:var(--danger); font-weight:800;"><i class="fa-solid fa-trash"></i> Anulowanie Rezerwacji</h3><i class="fa-solid fa-xmark" style="cursor:pointer;" onclick="closeModal('cancelReservationModal')"></i></div>
            <div class="modal-body">
                <form id="cancelReservationForm">
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label class="creator-label required">Podaj powód anulowania</label>
                        <select class="creator-input" required>
                            <option value="">-- Wybierz powód --</option>
                            <option value="rezygnacja">Rezygnacja klienta</option>
                            <option value="brak_kontaktu">Brak kontaktu z klientem</option>
                            <option value="odmowa_tu">Odmowa TU (Brak odpowiedzialności)</option>
                            <option value="awaria_auta">Pojazd niedostępny / Awaria</option>
                            <option value="inne">Inne</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-bottom: 25px;">
                        <label class="creator-label">Dodatkowa notatka (Opcjonalnie)</label>
                        <textarea class="creator-input" rows="3" placeholder="Szczegóły anulacji..."></textarea>
                    </div>
                    <div style="display:flex; justify-content:flex-end; gap:12px;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('cancelReservationModal')">Wróć</button>
                        <button type="submit" class="btn btn-danger"><i class="fa-solid fa-check"></i> Potwierdź Anulowanie</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Skrypty -->
    <script>
        // Nawigacja
        function toggleSubmenu(id) {
            const submenu = document.getElementById(id);
            const icon = document.getElementById('icon-' + id.replace('submenu-', ''));
            if (submenu.style.display === "none") {
                submenu.style.display = "block";
                if(icon) icon.style.transform = "rotate(180deg)";
            } else {
                submenu.style.display = "none";
                if(icon) icon.style.transform = "rotate(0deg)";
            }
        }

        function toggleViews(viewId) {
            document.querySelectorAll('.view-panel').forEach(p => p.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showReservationDetails(nr) {
            document.getElementById('detail-nr').innerText = nr;
            toggleViews('view-details');
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        // --- TRYB EDYCJI W KARCIE DETALI ---
        let isEditMode = false;
        function toggleEditMode() {
            const btn = document.getElementById('editDetailsBtn');
            const fields = document.querySelectorAll('#view-details .info-edit');
            
            isEditMode = !isEditMode;
            
            if (isEditMode) {
                // Odblokowanie edycji
                fields.forEach(f => f.setAttribute('contenteditable', 'true'));
                btn.innerHTML = '<i class="fa-solid fa-floppy-disk"></i> Zapisz Zmiany';
                btn.style.background = 'var(--success)';
                btn.style.borderColor = 'var(--success)';
                alert("TRYB EDYCJI: Możesz teraz edytować podświetlone na żółto informacje bezpośrednio w karcie.");
            } else {
                // Zapisywanie zmian
                fields.forEach(f => f.removeAttribute('contenteditable'));
                btn.innerHTML = '<i class="fa-solid fa-pen"></i> Edytuj';
                btn.style.background = '';
                btn.style.borderColor = '';
                alert("Zmiany zostały pomyślnie zaktualizowane w systemie.");
            }
        }

        // --- ANULOWANIE REZERWACJI (MODAL) ---
        function openCancelModal() {
            document.getElementById('cancelReservationModal').style.display = 'flex';
        }

        document.getElementById('cancelReservationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert("Rezerwacja została anulowana i usunięta z bieżącego harmonogramu.");
            closeModal('cancelReservationModal');
            toggleViews('view-list');
            this.reset();
        });

        // Logika formularza rezerwacji
        function toggleResContext() {
            const contextType = document.querySelector('input[name="rentContext"]:checked').value;
            const refBox = document.getElementById('contextReferenceBox');
            const label = document.getElementById('contextLabel');
            const input = document.getElementById('contextInput');

            if (contextType === 'szkoda') {
                refBox.classList.add('active');
                label.innerText = 'Numer Szkody (z systemu lub od TU)';
                input.placeholder = 'Wyszukaj szkodę...';
                input.setAttribute('required', 'true');
            } else if (contextType === 'naprawa') {
                refBox.classList.add('active');
                label.innerText = 'Numer Zlecenia Naprawy / Warsztatowego';
                input.placeholder = 'Wyszukaj zlecenie...';
                input.setAttribute('required', 'true');
            } else {
                refBox.classList.remove('active');
                input.removeAttribute('required');
                input.value = '';
            }
        }

        function toggleLogistics() {
            const logType = document.querySelector('input[name="logisticsType"]:checked').value;
            const addressBox = document.getElementById('deliveryAddressBox');
            const addressInput = document.getElementById('deliveryAddressInput');

            if (logType === 'delivery') {
                addressBox.classList.add('active');
                addressInput.setAttribute('required', 'true');
            } else {
                addressBox.classList.remove('active');
                addressInput.removeAttribute('required');
                addressInput.value = '';
            }
        }

        function toggleTimeInput() {
            const isTbd = document.getElementById('tbdCheck').checked;
            const timeInput = document.getElementById('timeInput');
            const timeLabel = document.getElementById('timeLabel');

            if (isTbd) {
                timeInput.value = '';
                timeInput.disabled = true;
                timeInput.removeAttribute('required');
                timeLabel.style.color = 'var(--text-muted)';
            } else {
                timeInput.disabled = false;
                timeInput.setAttribute('required', 'true');
                timeLabel.style.color = 'var(--text-dark)';
            }
        }

        function saveReservation() {
            const form = document.getElementById('reservationForm');
            if(!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            alert('Rezerwacja została pomyślnie dodana do Kalendarza Floty!');
            toggleViews('view-list');
            form.reset();
        }
    </script>
</body>
</html>